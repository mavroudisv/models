// Add this inside your existing script tag, just before the closing </script> tag

// Function to load signature data
async function loadSignatureData() {
  try {
    // Get all model directories
    const response = await fetch('signatures/');
    if (!response.ok) {
      console.error('Failed to fetch signatures directory');
      return;
    }
    
    // Parse the directory listing
    const modelDirs = [];
    const models = {};
    const lastUpdated = new Date().toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });
    
    // Update the last updated timestamp
    document.getElementById('last-updated').textContent = `Last updated: ${lastUpdated}`;
    
    // Fetch each model directory
    const fetchPromises = [];
    const modelCards = document.querySelector('.grid');
    
    // Clear existing model cards
    modelCards.innerHTML = '';
    
    // Make a direct request to each expected model directory
    const knownModels = ['gpt-4o-2024-05-13'];
    
    for (const modelName of knownModels) {
      try {
        const modelFiles = await fetch(`signatures/${modelName}/`);
        if (!modelFiles.ok) continue;
        
        // Process model files (you'd need server-side directory listing or index file)
        // For now, we'll just check for the existence of any JSON files
        const jsonFiles = await fetch(`signatures/${modelName}/`);
        
        if (jsonFiles.ok) {
          // For each model, find the most recent signature file
          const signatureRegex = /^([a-f0-9]+)_(\d{4}-\d{2}-\d{2})\.json$/;
          // This would be much easier if we had a server-side script or metadata file
          
          // For now, let's create a card with what we know
          const cardHtml = `
            <div class="signature-card bg-white rounded-lg shadow overflow-hidden">
              <div class="px-6 py-4 border-b border-gray-200 bg-indigo-50">
                <div class="font-bold text-xl text-gray-800">${modelName}</div>
                <div class="text-sm text-gray-600">Latest: Checking signatures...</div>
              </div>
              <div class="px-6 py-4">
                <div class="flex justify-between mb-2">
                  <span class="text-gray-700">Hash:</span>
                  <span class="font-mono text-gray-600">Checking...</span>
                </div>
                <div class="flex justify-between mb-2">
                  <span class="text-gray-700">Stability:</span>
                  <span class="text-green-600">Monitoring</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-700">Changes:</span>
                  <span class="text-gray-600">Checking history...</span>
                </div>
              </div>
              <div class="px-6 py-3 bg-gray-50">
                <a href="signatures/${modelName}/" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                  View signatures â†’
                </a>
              </div>
            </div>
          `;
          
          modelCards.innerHTML += cardHtml;
        }
      } catch (err) {
        console.error(`Error processing model ${modelName}:`, err);
      }
    }
    
  } catch (error) {
    console.error('Error loading signature data:', error);
  }
}

// Load signature data when the page loads
document.addEventListener('DOMContentLoaded', () => {
  loadSignatureData();
  
  // Other chart initializations as you already have...
});
